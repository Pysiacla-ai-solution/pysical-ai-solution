#!/usr/bin/env python3
"""
Mock squeue command for SLURM job queue listing
Usage: squeue [--format=json]
"""

import sys
import json
from pathlib import Path

JOBS_DIR = Path("/slurm/jobs")

def main():
    output_json = "--format=json" in sys.argv
    
    jobs = []
    
    # Read all job files
    if JOBS_DIR.exists():
        for job_file in sorted(JOBS_DIR.glob("*.json")):
            try:
                with open(job_file, 'r') as f:
                    job_data = json.load(f)
                    jobs.append(job_data)
            except Exception as e:
                print(f"Warning: Failed to read {job_file}: {e}", file=sys.stderr)
    
    if output_json:
        # JSON output
        print(json.dumps(jobs, indent=2))
    else:
        # Table output (SLURM-like)
        if jobs:
            print(f"{'JOBID':<10} {'NAME':<20} {'STATUS':<12} {'QOS':<10} {'SUBMITTED':<25}")
            print("-" * 80)
            for job in jobs:
                job_id = job.get("job_id", "")
                name = job.get("job_name", "")[:20]
                status = job.get("status", "")
                qos = job.get("qos", "")
                submitted = job.get("submitted_at", "")[:25]
                print(f"{job_id:<10} {name:<20} {status:<12} {qos:<10} {submitted:<25}")
        else:
            print("No jobs in queue")
    
    return 0

if __name__ == "__main__":
    sys.exit(main())
